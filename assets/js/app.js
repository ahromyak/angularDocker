
var cjs=angular.module('myApp',['ui.router']);cjs.controller('mainController',["$scope",function($scope){$scope.loadMoreRecords=function(){$scope.$broadcast('loadMoreEmails',{count:20})}}]);cjs.config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/home");var homeState={name:'home',url:'/home',controller:'homeController',templateUrl:'app/components/home/html/home.html'};$stateProvider.state(homeState);}]);cjs.factory('gapiFactory',["$q",function($q){var request;function _loadEmails(count){var deferred=$q.defer();gapi.client.load('gmail','v1',function(){request=gapi.client.gmail.users.messages.list({'userId':'me','maxResults':count});request.execute(function(resp){deferred.resolve(resp.messages);});});return deferred.promise;}
function _loadSingleEmail(threadId){var deferred=$q.defer();gapi.client.load('gmail','v1',function(){request=gapi.client.gmail.users.threads.get({'userId':'me','id':threadId});request.execute(function(resp){deferred.resolve(resp.messages[0]);console.log(resp);});});return deferred.promise;}
function _signIn(signInCallback){gapi.signin.render('signInButton',{'callback':signInCallback,'clientid':'162151956695-3voa7h9ij4e2mqasv69g6sp6uouqsc29.apps.googleusercontent.com','requestvisibleactions':'http://schemas.google.com/AddActivity','scope':'https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/gmail.readonly','cookiepolicy':'single_host_origin'});};return{signIn:_signIn,loadEmails:_loadEmails,loadSingleEmail:_loadSingleEmail}}]);cjs.controller('homeController',["$scope","$timeout","gapiFactory",function($scope,$timeout,gapiFactory){var emailCount=20;$scope.signedIn=false;$scope.processAuth=function(authResult){if(authResult['access_token']){$scope.signedIn=true;}else if(authResult['error']){$scope.signedIn=false;}};$scope.signInCallback=function(authResult){var promiseEmails;$scope.$apply(function(){$scope.processAuth(authResult);});promiseEmails=gapiFactory.loadEmails(emailCount);promiseEmails.then(function(data){$scope.mailList=data;});};$scope.renderSignInButton=function(){gapiFactory.signIn($scope.signInCallback);};$scope.start=function(){$scope.renderSignInButton();};$scope.signOut=function(){gapi.auth.signOut();};$timeout(function(){$scope.start();},1000);$scope.modalShown=false;$scope.toggleModal=function(itemData){var promiseSingleEmail;promiseSingleEmail=gapiFactory.loadSingleEmail(itemData);promiseSingleEmail.then(function(data){$scope.itemData=data.snippet;});$scope.modalShown=!$scope.modalShown;};$scope.$on('loadMoreEmails',function(){var promiseEmails;emailCount+=20;promiseEmails=gapiFactory.loadEmails(emailCount);promiseEmails.then(function(data){$scope.mailList=data;});});}]);cjs.directive('modalDialog',function(){return{restrict:'E',scope:{show:'=',itemData:'='},replace:true,link:function(scope,element,attrs){scope.dialogStyle={};if(attrs.width)
scope.dialogStyle.width=attrs.width;if(attrs.height)
scope.dialogStyle.height=attrs.height;scope.hideModal=function(){scope.show=false;};},templateUrl:'app/components/home/html/modal.html'};});cjs.directive('whenScrollEnds',function(){return{restrict:"A",link:function(scope,element,attrs){var visibleHeight=element.height();var threshold=1000;element.scroll(function(){var scrollableHeight=element.prop('scrollHeight');var hiddenContentHeight=scrollableHeight-visibleHeight;if(hiddenContentHeight-element.scrollTop()<=threshold){scope.$apply(attrs.whenScrollEnds);}});}};});